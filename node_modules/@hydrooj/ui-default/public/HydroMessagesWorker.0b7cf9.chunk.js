(()=>{try{let y=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},T=new y.Error().stack;T&&(y._sentryDebugIds=y._sentryDebugIds||{},y._sentryDebugIds[T]="26f5a9c7-c958-4a6a-a0c6-770f3069e80b",y._sentryDebugIdIdentifier="sentry-dbid-26f5a9c7-c958-4a6a-a0c6-770f3069e80b")}catch(y){}{let y=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};y.SENTRY_RELEASE={id:"2267ac9984bf2a03311b765d1b1928f9f4cc2bd8"}}(()=>{"use strict";var y={28325:(_,a,c)=>{c.r(a),c.d(a,{default:()=>E});/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var g=function(t,e){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])},g(t,e)};function w(t,e){g(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function C(t){var e=typeof Symbol=="function"&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function u(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(p){s={error:p}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return i}function L(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t}var O=function(){function t(e,n){this.target=n,this.type=e}return t}(),m=function(t){w(e,t);function e(n,r){var o=t.call(this,"error",r)||this;return o.message=n.message,o.error=n,o}return e}(O),v=function(t){w(e,t);function e(n,r,o){n===void 0&&(n=1e3),r===void 0&&(r="");var i=t.call(this,"close",o)||this;return i.wasClean=!0,i.code=n,i.reason=r,i}return e}(O);/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */var S=function(){if(typeof WebSocket<"u")return WebSocket},d=function(t){return typeof t<"u"&&!!t&&t.CLOSING===2},l={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},h=function(){function t(e,n,r){var o=this;r===void 0&&(r={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(i){o._debug("open event");var s=o._options.minUptime,p=s===void 0?l.minUptime:s;clearTimeout(o._connectTimeout),o._uptimeTimeout=setTimeout(function(){return o._acceptOpen()},p),o._ws.binaryType=o._binaryType,o._messageQueue.forEach(function(f){return o._ws.send(f)}),o._messageQueue=[],o.onopen&&o.onopen(i),o._listeners.open.forEach(function(f){return o._callEventListener(i,f)})},this._handleMessage=function(i){o._debug("message event"),o.onmessage&&o.onmessage(i),o._listeners.message.forEach(function(s){return o._callEventListener(i,s)})},this._handleError=function(i){o._debug("error event",i.message),o._disconnect(void 0,i.message==="TIMEOUT"?"timeout":void 0),o.onerror&&o.onerror(i),o._debug("exec error listeners"),o._listeners.error.forEach(function(s){return o._callEventListener(i,s)}),o._connect()},this._handleClose=function(i){o._debug("close event"),o._clearTimeouts(),o._shouldReconnect&&o._connect(),o.onclose&&o.onclose(i),o._listeners.close.forEach(function(s){return o._callEventListener(i,s)})},this._url=e,this._protocols=n,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(t,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CONNECTING",{get:function(){return t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OPEN",{get:function(){return t.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSING",{get:function(){return t.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSED",{get:function(){return t.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce(function(n,r){return typeof r=="string"?n+=r.length:r instanceof Blob?n+=r.size:n+=r.byteLength,n},0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?t.CLOSED:t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),t.prototype.close=function(e,n){if(e===void 0&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,n)},t.prototype.reconnect=function(e,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,n),this._connect())},t.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var n=this._options.maxEnqueuedMessages,r=n===void 0?l.maxEnqueuedMessages:n;this._messageQueue.length<r&&(this._debug("enqueue",e),this._messageQueue.push(e))}},t.prototype.addEventListener=function(e,n){this._listeners[e]&&this._listeners[e].push(n)},t.prototype.dispatchEvent=function(e){var n,r,o=this._listeners[e.type];if(o)try{for(var i=C(o),s=i.next();!s.done;s=i.next()){var p=s.value;this._callEventListener(e,p)}}catch(f){n={error:f}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return!0},t.prototype.removeEventListener=function(e,n){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(r){return r!==n}))},t.prototype._debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._options.debug&&console.log.apply(console,L(["RWS>"],e))},t.prototype._getNextDelay=function(){var e=this._options,n=e.reconnectionDelayGrowFactor,r=n===void 0?l.reconnectionDelayGrowFactor:n,o=e.minReconnectionDelay,i=o===void 0?l.minReconnectionDelay:o,s=e.maxReconnectionDelay,p=s===void 0?l.maxReconnectionDelay:s,f=0;return this._retryCount>0&&(f=i*Math.pow(r,this._retryCount-1),f>p&&(f=p)),this._debug("next delay",f),f},t.prototype._wait=function(){var e=this;return new Promise(function(n){setTimeout(n,e._getNextDelay())})},t.prototype._getNextUrl=function(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){var n=e();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")},t.prototype._connect=function(){var e=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var n=this._options,r=n.maxRetries,o=r===void 0?l.maxRetries:r,i=n.connectionTimeout,s=i===void 0?l.connectionTimeout:i,p=n.WebSocket,f=p===void 0?S():p;if(this._retryCount>=o){this._debug("max retries reached",this._retryCount,">=",o);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!d(f))throw Error("No valid WebSocket class provided");this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(N){e._closeCalled||(e._debug("connect",{url:N,protocols:e._protocols}),e._ws=e._protocols?new f(N,e._protocols):new f(N),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},s))})}},t.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new m(Error("TIMEOUT"),this))},t.prototype._disconnect=function(e,n){if(e===void 0&&(e=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,n),this._handleClose(new v(e,n,this))}catch(r){}}},t.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},t.prototype._callEventListener=function(e,n){"handleEvent"in n?n.handleEvent(e):n(e)},t.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},t.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},t.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},t}();const E=h},11144:(_,a,c)=>{c.r(a),c.d(a,{FLAG_ALERT:()=>w,FLAG_I18N:()=>L,FLAG_INFO:()=>u,FLAG_RICHTEXT:()=>C,FLAG_UNREAD:()=>g});const g=1,w=2,C=4,u=8,L=16},12775:function(_,a,c){var g=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(a,"__esModule",{value:!0});const w=g(c(28325)),C=c(11144);console.log("SharedWorker init");let u,L;const O=new Set,m={};function v(d){for(const l of O)l.postMessage(d)}function S(d,l,h){if(O.add(l),h!==L)u==null||u.close();else if(u&&u.readyState===u.OPEN)return;const E=new URL(d,location.origin);h&&E.searchParams.set("sid",h.split("sid=")[1].split(";")[0]),L=h,console.log("Init connection for",d),u==null||u.close(),u=new w.default(E.toString()),u.onopen=()=>{console.log("Connected to",d),v({type:"open"})},u.onerror=()=>v({type:"error"}),u.onclose=t=>v({type:"close",error:t.reason}),u.onmessage=t=>{if(t.data==="ping"){u.send("pong");return}const e=JSON.parse(t.data);if(["PermissionError","PrivilegeError"].includes(e.error))v({type:"close",error:e.error}),u.close();else{v({type:"message",payload:e});let n=!1;m[e.mdoc._id]=()=>{n=!0},setTimeout(()=>{if(delete m[e.mdoc._id],!n&&!(e.mdoc.flag&C.FLAG_INFO)){if((Notification==null?void 0:Notification.permission)!=="granted"){console.log("Notification permission denied");return}new Notification(e.udoc.uname||"Hydro Notification",{tag:`message-${e.mdoc._id}`,icon:e.udoc.avatarUrl||"/android-chrome-192x192.png",body:e.mdoc.content})}},5e3)}}}self.onconnect=function(d){const l=d.ports[0];l.addEventListener("message",h=>{var E;h.data.type==="conn"&&S(h.data.path,l,h.data.cookie),h.data.type==="ack"&&((E=m[h.data.id])==null||E.call(m)),h.data.type==="unload"&&O.delete(l)}),l.start()}}},T={};function b(_){var a=T[_];if(a!==void 0)return a.exports;var c=T[_]={exports:{}};return y[_].call(c.exports,c,c.exports,b),c.exports}b.d=(_,a)=>{for(var c in a)b.o(a,c)&&!b.o(_,c)&&Object.defineProperty(_,c,{enumerable:!0,get:a[c]})},b.o=(_,a)=>Object.prototype.hasOwnProperty.call(_,a),b.r=_=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})};var P=b(12775)})();})();

//# sourceMappingURL=HydroMessagesWorker.0b7cf9.chunk.js.map