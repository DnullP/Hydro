(()=>{try{let a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},u=new a.Error().stack;u&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[u]="81b5f9e8-ad2e-413a-b8e6-700dc7426adb",a._sentryDebugIdIdentifier="sentry-dbid-81b5f9e8-ad2e-413a-b8e6-700dc7426adb")}catch(a){}{let a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"2267ac9984bf2a03311b765d1b1928f9f4cc2bd8"}}(()=>{"use strict";var a=(e,n,s)=>new Promise((t,r)=>{var l=d=>{try{c(s.next(d))}catch(h){r(h)}},i=d=>{try{c(s.throw(d))}catch(h){r(h)}},c=d=>d.done?t(d.value):Promise.resolve(d.value).then(l,i);c((s=s.apply(e,n)).next())});const u=new Map;function C(e){return new ReadableStream({start(n){e.onmessage=({data:s})=>s==="end"?n.close():s==="abort"?n.error("Aborted the download"):n.enqueue(s)},cancel(n){console.log("user aborted",n),e.postMessage({abort:!0})}})}self.onmessage=e=>{if(e.data==="ping")return;const n=e.data,s=n.url||`${self.registration.scope+Math.random()}/${typeof n=="string"?n:n.filename}`,t=e.ports[0],r=new Array(3);r[1]=n,r[2]=t,e.data.readableStream?r[0]=e.data.readableStream:e.data.transferringReadable?t.onmessage=l=>{t.onmessage=null,r[0]=l.data.readableStream}:r[0]=C(t),u.set(s,r),t.postMessage({download:s})};function L(e){const n=u.get(e.request.url),[s,t,r]=n;u.delete(e.request.url);const l=new Headers({"Content-Type":"application/octet-stream; charset=utf-8","Content-Security-Policy":"default-src 'none'","X-Content-Security-Policy":"default-src 'none'","X-WebKit-CSP":"default-src 'none'","X-XSS-Protection":"1; mode=block"}),i=new Headers(t.headers||{});i.has("Content-Length")&&l.set("Content-Length",i.get("Content-Length")),i.has("Content-Disposition")&&l.set("Content-Disposition",i.get("Content-Disposition")),t.size&&(console.warn("Depricated"),l.set("Content-Length",t.size));let c=typeof t=="string"?t:t.filename;c&&(console.warn("Depricated"),c=encodeURIComponent(c).replace(/['()]/g,escape).replace(/\*/g,"%2A"),l.set("Content-Disposition",`attachment; filename*=UTF-8''${c}`)),e.respondWith(new Response(s,{headers:l})),r.postMessage({debug:"Download started"})}self.addEventListener("notificationclick",e=>{console.log("On notification click: ",e.notification.tag),e.notification.close(),e.notification.tag.startsWith("message-")&&e.waitUntil(self.clients.matchAll({type:"window"}).then(n=>{for(const s of n)if(s.url==="/home/messages"&&"focus"in s)return s.focus();return self.clients.openWindow&&self.clients.openWindow("/home/messages"),null}))});const p="precache-4.57.0",S=[".worker.js","fonts"];function m(e){return!(!e.split("?")[0].split("/").pop()||!e.split("?")[0].split("/").pop().includes("."))}function w(e){return!m(e.url)||e.headers.get("Pragma")==="no-cache"?!1:["get","head","options"].includes(e.method.toLowerCase())}function P(e){return!(!m(e)||S.filter(n=>e.includes(n)).length)}let o=null;function R(e){o=e,o.hosts||(o.hosts=[]),o.domains=Array.from(new Set([location.host,...o.domains||[]])),console.log("Config:",o)}self.addEventListener("install",e=>e.waitUntil(a(void 0,null,function*(){if(o!=null&&o.preload){const[n,s]=yield Promise.all([caches.open(p),fetch("/manifest.json").then(r=>r.json())]),t=Object.values(s).filter(P).map(r=>new URL(r,o.preload).toString());yield n.addAll(t)}self.skipWaiting()}))),self.addEventListener("activate",e=>{e.waitUntil(self.clients.claim());const n=[p];caches.keys().then(s=>s.filter(t=>t.startsWith("precache-")).filter(t=>!n.includes(t)).map(t=>caches.delete(t)))});function k(e){return a(this,null,function*(){const n=w(e);for(const s of o.domains||[]){const t=new URL(e.url);t.host=s;try{console.log("From ",t.toString());const r=yield fetch(t,{method:e.method,credentials:n?"same-origin":"include",headers:e.headers,body:e.body,redirect:e.redirect,keepalive:e.keepalive,referrer:e.referrer,referrerPolicy:e.referrerPolicy,signal:e.signal});if(r.ok)return console.log("Load success from ",t.toString()),r}catch(r){console.warn(t.toString()," Load fail ",r)}}return null})}function b(e){const n=new URL(e),s=n.pathname;return(s.startsWith("/fs/")||s.toLowerCase().includes("x-amz"))&&(n.search=""),n.toString()}function W(e,n,s){return a(this,null,function*(){const t=b(e.url),r=new URL(t),i=!o.assets.some(g=>e.url.startsWith(g))&&o.domains.length>1&&o.domains.includes(r.hostname)&&r.origin===location.origin;let c=[t];if(i&&(c=o.domains.map(g=>{const y=new URL(e.url);return y.host=g,b(y.toString())})),!w(e))return i?s():fetch(e);const h=(yield Promise.all(c.map(g=>caches.match(g)))).find(g=>g);if(h)return console.debug("Serve from cache %s <- %s",e.url,h.url),h;const[E,f]=yield Promise.all([caches.open(n),s().catch(()=>null)]);return(f==null?void 0:f.status)===206?f:f!=null&&f.ok?(console.log(`Cached ${t}`),E.put(t,f.clone()),f):(console.log(`Failed to cache ${t}`,f),fetch(e))})}self.addEventListener("fetch",e=>{var n,s;if(e.request.url.endsWith("/ping")){e.respondWith(new Response("pong"));return}if(e.request.url.endsWith("/service-worker-config")){e.request.json().then(i=>R(i)),e.respondWith(new Response("ok"));return}if(u.get(e.request.url)){L(e);return}if(!["get","post","head"].includes(e.request.method.toLowerCase())||!o)return;const t=new URL(e.request.url),r=o.assets.some(i=>e.request.url.startsWith(i)),l=!r&&o.domains.length>1&&o.domains.includes(t.hostname)&&t.origin===location.origin;!r&&!o.hosts.some(i=>e.request.url.startsWith(i))||(s=(n=e.request.headers.get("range"))==null?void 0:n.trim())!=null&&s.length||e.respondWith(a(void 0,null,function*(){return W(e.request,r?"assets":p,()=>l?k(e.request):fetch(t,{method:e.request.method,headers:e.request.headers,redirect:e.request.redirect,keepalive:e.request.keepalive,referrer:e.request.referrer,referrerPolicy:e.request.referrerPolicy,signal:e.request.signal}))}))})})();})();

//# sourceMappingURL=service-worker.js.map?a1e20e